# Build a simple custom MySQL image that copies init scripts into the official image.
# Note: It's preferable to keep credentials in docker-compose/environment, not baked into the image.
FROM mysql:8.0

LABEL org.opencontainers.image.title="everaccess-mysql"
LABEL org.opencontainers.image.description="MySQL server for everaccess (custom image for init scripts)"

# Optional default env (override in docker-compose for security)
ENV MYSQL_ROOT_PASSWORD=rootpassword \
    MYSQL_DATABASE=development \
    MYSQL_USER=devuser \
    MYSQL_PASSWORD=devpassword

# Copy initialization SQL / scripts
COPY ./mysql-init /docker-entrypoint-initdb.d
RUN chown -R mysql:mysql /docker-entrypoint-initdb.d

VOLUME ["/var/lib/mysql"]

EXPOSE 3306

# Simple healthcheck (adjust password if you override MYSQL_ROOT_PASSWORD)
HEALTHCHECK --interval=10s --timeout=5s --start-period=10s --retries=5 \
  CMD ["sh", "-c", "mysqladmin ping -uroot -prootpassword > /dev/null 2>&1 || exit 1"]

CMD ["mysqld"]